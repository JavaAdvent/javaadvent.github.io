---
id: 37
title: '(Part 3 of 3): Synopsis of articles &#038; videos on Performance tuning, JVM, GC in Java, Mechanical Sympathy, et al'
date: 2013-12-23T09:00:00+00:00
author: gpanther
layout: post
guid: http://www.javaadvent.com/2013/12/part-3-of-3-synopsis-of-articles-videos-on-performance-tuning-jvm-gc-in-java-mechanical-sympathy-et-al/
permalink: /2013/12/part-3-of-3-synopsis-of-articles-videos-on-performance-tuning-jvm-gc-in-java-mechanical-sympathy-et-al.html
blogger_blog:
  - www.javaadvent.com
blogger_author:
  - Mani Sarkar
blogger_permalink:
  - /2013/12/part-3-of-3-synopsis-of-articles-videos.html
blogger_internal:
  - /feeds/2481158163384033132/posts/default/4536709978408652303
categories:
  - 2013
  - Atomic I/O
  - CPU
  - GC
  - hotspot
  - java
  - JIT
  - JVM
  - Linux
  - low latency
  - mechanical sympathy
  - Memory Barriers
  - performance tuning
---
<div style="text-align: justify;"><div style="text-align: start;"><div><i><span style="font-family: Verdana, sans-serif;">This is a continuation of the previous post titled&nbsp;<a href="http://www.javaadvent.com/2013/12/part-2-of-3-synopsis-of-articles-videos.html" target="_blank">(Part 2 of 3): Synopsis of articles &amp; videos on Performance tuning, JVM, GC in Java, Mechanical Sympathy, et al</a>.</span></i><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><span style="text-align: justify;">In our first review, <i>The Atlassian guide to GC tuning</i> is an extensive post covering the methodology and things to keep in mind when tuning GC, practical examples are given and references to important resources are also made in the process. The next one How NOT to measure latency by Gil Tene, he discusses some common pitfalls encountered in measuring and characterizing latency, demonstrating and discussing some false assumptions and measurement techniques that lead to dramatically incorrect reporting results, and covers simple ways to sanity check and correct these situations. &nbsp;Finally&nbsp;</span><span style="text-align: justify;">Kirk Pepperdine in his post&nbsp;</span><i>Poorly chosen Java HotSpot Garbage Collection Flags and how to fix them!&nbsp;</i><span style="text-align: justify;">throws light on some JVM flags - he starts with some 700 flags and boils it down to merely 7 flags. Also cautions you to not just draw conclusions or to take action in a whim but consult and examine - i.e. </span><i style="text-align: justify;">measure</i><span style="text-align: justify;"> </span><u style="text-align: justify;">don't guess</u><span style="text-align: justify;">!</span></span><br /><div style="text-align: justify;"><br /></div></div><div style="orphans: auto; text-align: start; text-indent: 0px; widows: auto;"><div style="margin: 0px;"><div style="-webkit-text-stroke-width: 0px; color: black; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, sans-serif;"><strong><a href="https://confluence.atlassian.com/display/ATLAS/Garbage+Collection+(GC)+Tuning+Guide" target="_blank">Garbage Collection (GC) Tuning Guide</a>&nbsp;by Atlassian</strong></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><div style="font-size: medium; font-style: normal; font-weight: normal; margin: 0px;"><div><i style="font-family: 'Times New Roman'; text-align: justify;"><br /></i><i style="text-align: justify;"><span style="font-family: Verdana, serif;">Background</span></i><br /><i style="text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></i></div><div style="text-align: justify;"><span style="font-family: Verdana, serif;">By default JVM tunings attempt to provide acceptable performance in majority of the cases, but it may not always give the desired results depending on application behaviour. Benchmark your application before applying any GC or JVM related settings. There are a number of environment, OS, hardware related factors to taken into consideration and many a times any tuning to JVM may be linked to these factors and if they chance the tuning may need to be revisited. Beware and accept the fact that any tuning has its upper limit in a given environment, if your goals are still not met, then you need to improve your environment. Always monitor your application to see if your tuning goals are still in scope.</span></div><div style="text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="text-align: justify;"><span style="font-family: Verdana, serif;"><i>Choosing Performance Goals</i>&nbsp;- GC for the Oracle JVM can be reduced by targeting three goals ie. latency (mean &amp; maximum), throughput, and footprint. To reach the tuning goals, there are principles that guide you to tuning the GC i.e. Minor GC reclamation, GC maximise memory, two of three (pick 2 of 3 of these goals, and sacrifice the other).</span></div></div><div style="margin: 0px;"><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><i><span style="font-family: Verdana, serif;">Preparing your environment for GC -&nbsp;</span></i></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Some of the items of interest are load the application with work (apply load to the application as it would be in production), turn on GC logging, set data sampling windows, determine memory footprint, rules of thumb for generation sizes, determine systemic requirements.</span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;">Iteratively change the JVM parameters keeping the environment its setting in tact. An example of turning on GC logging is:</span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: inherit;"><br /></span></div><pre style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Courier New, Courier, monospace;">java -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:&lt;file&gt; …</span></pre><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><div><span style="font-family: Verdana, serif;">or</span></div></div><pre style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Courier New, Courier, monospace;">java -XX:+PrintGC -XX:+PrintGCDetails <span style="white-space: normal;">-XX:+PrintGCDateStamps</span> -Xloggc:&lt;file&gt; …</span></pre><div style="font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: inherit;"><br /></span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;">Sampling windows are important to help specifically diagnose an application's runtime rather than the load-time or time it or the JVM takes to stabilise before it can execute anything. Set the heap sizes either by guessing (give it maximum and then pull back) or by using results accumulated in the GC logs. Also check for OOME which can be an indicator if heap size or standard memory needs increasing. There are a number of rules of thumb for generation sizes (a number of them depend on sizes of other pools).&nbsp;</span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><i><span style="font-family: Verdana, serif;">Understanding the Throughput collector and Behaviour based Tuning</span></i></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;">Hotspot uses behaviour based tuning with parallel collectors including the MarkAndSweep collector, they are designed to keep three goals in mind i.e. maximum pause time, throughput and footprint. The</span><span style="font-family: inherit;"> -</span><span style="font-family: Courier New, Courier, monospace;">-XX:+PrintAdaptiveSizePolicy</span><span style="font-family: inherit;"> </span><span style="font-family: Verdana, serif;">JVM flag prints details of this behaviour for analysis. Even though there are options to set the maximum pause time for any GC event there is no guarantee it will be performed. It also uses the best of 2 (from 3) goals - i.e. only 2 goals are focussed at a time, and there is interaction between goals, and sometimes there is oscillation between them.</span></div><div style="font-size: medium; font-style: normal; font-weight: normal;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="font-size: medium; font-style: normal; font-weight: normal;"><i><span style="font-family: Verdana, serif;">Time to tune</span></i></div><div style="font-size: medium; font-style: normal; font-weight: normal;"><span style="font-family: Verdana, serif;">There is a cycle to follow when doing this, i.e.&nbsp;</span></div><ol style="font-size: medium; font-style: normal; font-weight: normal;"><li><span style="font-family: Verdana, serif;">Determine desired behaviour.</span></li><li><span style="font-family: Verdana, serif;">Measure behaviour before change.</span></li><li><span style="font-family: Verdana, serif;">Determine indicated change.</span></li><li><span style="font-family: Verdana, serif;">Make change.</span></li><li><span style="font-family: Verdana, serif;">Measure behaviour after change.</span></li><li><span style="font-family: Verdana, serif;">If behaviour not met, try again.</span></li></ol><div style="font-size: medium; font-style: normal; font-weight: normal;"><span style="font-family: Verdana, serif;">Repeat the above till the results are met (or nearly there).</span></div><div style="font-size: medium; font-style: normal; font-weight: normal;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="font-size: medium; font-style: normal; font-weight: normal;"><i><span style="font-family: Verdana, serif;">Tools</span></i></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;"><a href="http://visualvm.java.net/" target="_blank">Java VisualVM</a>&nbsp;with Visual GC plugin for live telemetry (note there's an observer effect when using VisualVM, which can have an impact on your readings).&nbsp;<a href="http://www.tagtraum.com/gcviewer.html" target="_blank">GCViewer</a>&nbsp;by Tagtruam industries, useful for post-hoc review of GC performance based on the GC log.&nbsp;</span></div><div style="font-size: medium; font-style: normal; font-weight: normal;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="font-size: medium; font-style: normal; font-weight: normal; text-align: justify;"><span style="font-family: Verdana, serif;"><b>Conclusions:</b>&nbsp;a lot of factors need to be taken into consideration when tuning GC. A meticulous plan needs to be considered, keeping an eye on your goal throughout the process and once achieved, you continue to monitor your application to see if your performance goals are still intact. Adjust your requirements after studying the results of your actions such that they both meet at some point.</span></div><div style="font-size: medium; font-style: normal; font-weight: normal;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="text-align: justify;"><div style="font-size: medium; font-style: normal; font-weight: normal;"><span style="font-family: Verdana, serif; font-style: italic;">--- The authors cover the methodology in good detail and give practical advise and steps to follow in order to tune your application - the hands-on and practical aspects of the blog should definitely be read. ---</span></div><div style="font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-weight: normal;"><br /></div><div style="font-size: medium; font-weight: normal;"><strong style="text-align: start;"><span style="font-family: Verdana, serif;"><a href="http://www.infoq.com/presentations/latency-pitfalls" style="font-style: normal;" target="_blank">How NOT to measure Latency</a>&nbsp;by <i>Gil Tene</i></span></strong></div><div style="font-size: medium; font-weight: normal;"><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">The author starts with saying &nbsp;"some of the mistakes others including the author has made" - plenty of wrong ways to do things and what to avoid doing.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">WHY and HOW - you measure latency, HOW only makes sense if you understand the WHY. There is public domain code / tools available that can be used to measure latency.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Don't use statistics to measure latency!</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Classic way of looking at latency - response time (latency) is a function of load! Its important to know what this response time - is it average, worst case, 99 percentile, etc... based on different types of behaviours?</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Hiccups - some sort of accumulated work that gets performed in bursts (spikes). Important to look at these behaviours when looking at response time and average response time. They are not evenly spread around, but may look like periodic freezes, shifts from one mode/behaviour to another (no sequence).</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Common fallacies:</span><br /><span style="font-family: Verdana, serif;">- computers run application code continously</span><br /><span style="font-family: Verdana, serif;">- response time can be measure as a work units over time</span><br /><span style="font-family: Verdana, serif;">- response time exhibits a normal distribution</span><br /><span style="font-family: Verdana, serif;">- "glitches" or "semi-random omissions" in measurement don't have a big effect</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Hiccups are hidden knowingly or unknowingly - i.e. averages and standard deviations can help!</span><br /><span style="font-family: Verdana, serif;">Many compute the 99 percentile or another figure from averages and distributions. A better way to deal with it is to measure it using data - for e.g. plot a histogram. You need to have a SLA for the entire spread and plot the distribution across 0 to 100 percentile.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Latency tells us how long something should take! True real-time is being slow and steady!</span></div><div style="font-size: medium;"><span style="font-family: Verdana, serif;">Author gives examples of types of applications with different latency needs i.e. The Olympics, Pacemaker, Low latency trading, Interactive applications.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">A very important way to establishing requirements - an extensive interview process, to help the client come up with a realistic figures for the SLA requirements. We need to find out what is the worst the client is willing to accept and&nbsp;for how long or how often is that acceptable, to help construct a percentile table.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Question is how fast can the system run, smoothly without hitting an obstacles or crashes! The author further makes a comparison of performance between the HotSpot JVM and C4.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;"><i><b>Coordinated omission</b></i> problem - what is it? data that it is not emitted in a random way but in a coordinated way that skews the actual data. Delays in request times does not get measured due to the manner in which response time is recorded from within the system - which omits random uncoordinated data. The <b>maximum value (time)</b> in the data usually is the key value to start with to compute and compare the other percentiles and check if it matches with that computed with coordinated emission in it. <i>Percentiles are useful, compute them</i>.</span><br /><span style="font-family: Verdana, serif;"><br /></span><i><span style="font-family: Verdana, serif;">Graphs with sudden bumps and more smooth lines tend to have coordinated emission in it.</span></i><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;"><i>HdrHistogram</i> helps plot histograms - a configurable precision system, telling it the range and precision to cover. It has built in compensation for Coordinated Omission - its OpenSource and available on Github under the CCO license.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">jHiccup also plots histogram to show how your computer system has been behaving (run-time and freeze time), also records various percentiles, maximum and minimum values, distribution, good modes, bad modes, etc.... Also opensource under COO license.</span><br /><span style="font-family: Verdana, serif;"><br /></span><span style="font-family: Verdana, serif;">Measuring throughput without a latency requirement, the information is meaningless. &nbsp;Mistakes in measurement/analysis can lead to orders-of-magnitude errors and lead to bad business decisions.</span><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"></div><span style="font-family: Verdana, serif;"><br /></span><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"><div style="margin: 0px;"><span style="font-style: italic; text-align: justify;"><span style="font-family: Verdana, serif;">--- The author has shown some cool graphs and illustrations of how we measure things wrong and what to look out for when assessing data or even graphs. Gives a lot of tips, on how NOT to measure latency. ---</span></span></div><div style="margin: 0px;"><span style="font-style: italic; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></span></div></div></div><span style="font-family: Verdana, serif; text-align: start;"><b><a href="http://www.jclarity.com/2013/12/11/poorly-chosen-java-hotspot-garbage-collection-flags-and-how-to-fix-them/" target="_blank">Poorly chosen Java HotSpot Garbage Collection Flags and how to fix them!</a>&nbsp;by<i> Kirk Pepperdine</i></b></span></div></div></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">There are more than 700 product flags defined in the HotSpot JVM and not many have a good idea of what effect it might have when used in runtime, let be the combination of two or more together.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">Whenever you think you know a flag, it often pays if you check out the source code underlying that flag to get a more accurate idea.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><u><span style="font-family: Verdana, serif;">Identifying redundant flags</span></u></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">The author enlists a huge list of flags for us to determine if we need them or not. It see a list of flags available with your version of java, try this command, to get a long list of options:</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Courier New, Courier, monospace;">$ java -XX:+PrintFlagsFinal &nbsp;</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">You can narrow down the list by eliminating deprecated flags and ones with a default value, leaving us with a much shorter list.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="text-align: justify;"><u><span style="font-family: Verdana, serif;">DisableExplicitGC, ExplicitGCInvokesConcurrent, and RMI Properties</span></u></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">Calling </span><span style="font-family: Courier New, Courier, monospace;">System.gc()</span><span style="font-family: Verdana, serif;"> isn't a great idea and one way to disable that functionality from code that uses it, is to use the DisableExplicitGC flag as one of the arguments of your VM options flags. Or instead use the&nbsp;</span><span style="font-family: Courier New, Courier, monospace;">ExplicitGCInvokesConcurrent</span><span style="font-family: Verdana, serif;">&nbsp;flag to invoke the Concurrent Mark and Sweep cycle instead of the Full GC cycle (invoked by&nbsp;</span><span style="font-family: Courier New, Courier, monospace;">System.gc()</span><span style="font-family: Verdana, serif;">). You can also set the interval period between complete GC cycles using the&nbsp;</span><span style="font-family: Courier New, Courier, monospace;">sun.rmi.dgc.client.gcInterval</span><span style="font-family: Verdana, serif;"> and </span><span style="font-family: Courier New, Courier, monospace;">sun.rmi.dgc.server.gcInterval</span><span style="font-family: Verdana, serif;">&nbsp;properties.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="text-align: justify;"><u><span style="font-family: Verdana, serif;">Xmx, Xms, NewRatio, SurvivorRatio and TargetSurvivorRatio</span></u></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">The </span><span style="font-family: Courier New, Courier, monospace;">-Xmx</span><span style="font-family: Verdana, serif;">&nbsp;flag is used to set the maximum heap size, and all JVMs are meant to support this flag. By adjusting the minimum and maximum heap sizes such that the JVM can't resize the heap size at runtime disables the properties of the adaptive sizing properties.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">Use GC logs to help make memory pool size decisions. There is a ratio to maintain between Young Gen and Old Gen and within Young Gen between Eden and the Survivor spaces. The&nbsp;</span><span style="font-family: Courier New, Courier, monospace;">SurvivorRatio</span><span style="font-family: Verdana, serif;">&nbsp;flag is one such flag that helps decide how much space will be used by the survivor spaces in Young gen and the rest will be left for Eden. These ratios are key towards determining the frequency and efficiency of the collections in Young Gen.&nbsp;</span><span style="text-align: start;"><span style="font-family: Courier New, Courier, monospace;">TargetSurvivorRatio</span><span style="font-family: Verdana, serif;">&nbsp;</span></span><span style="font-family: Verdana, serif;">is another ratio to examine and cross-check before using.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><u><span style="font-family: Verdana, serif;">PermSize, MaxPermSize</span></u><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">These options are removed starting JDK 8 in favour of Meta space, but in previous versions it helped in setting PermGen's resizing abilities. Restricting its adaptive nature might lead to longer pauses of old generational spaces.&nbsp;</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><u><span style="font-family: Verdana, serif;">UseConcMarkSweepGC, CMSParallelRemarkEnabled, UseCMSInitiatingOccupancyOnly CMSInitiatingOccupancyFraction</span></u><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Courier New, Courier, monospace;">UseConcMarkSweepGC</span><span style="font-family: Verdana, serif;">&nbsp;makes the JVM select the CMS collector, CMS works with ParNew &nbsp; instead of the PSYoung and PSOld collectors for the respective&nbsp;</span><span style="font-family: Times, 'Times New Roman', serif;">generational spaces.&nbsp;</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Times, 'Times New Roman', serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, sans-serif;">CMSInitiatingOccupancyFraction (IOF) is flag that helps the JVM determine how to maintain the occupancy of data (by examining the current rate of promotion) in the Old Gen space, sometimes leading to STW, FullGCs or CMF (concurrent mode failure).&nbsp;</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Courier New, Courier, monospace;">UseCMSInitiatingOccupancyOnly</span><span style="font-family: Times, 'Times New Roman', serif;">&nbsp;</span><span style="font-family: Verdana, sans-serif;">tells the JVM to use the IOF without taking the rate of promotion into account.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Courier New, Courier, monospace;">CMSParallelRemarkEnabled</span><span style="font-family: Verdana, serif;">&nbsp;helps parallelise the fourth phase of the CMS (single threaded by default), but use this option only after benchmarking your current production systems.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-style: italic; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></span></div><span style="text-align: justify;"><u><span style="font-family: Verdana, serif;">CMSClassUnloadingEnabled</span></u></span><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Courier New, Courier, monospace;">CMSClassUnloadingEnabled</span><span style="font-family: Verdana, serif;">&nbsp;ensures that classes loaded in the PermGen space is regularly unloaded reducing situations of out-of-PermGen-space. Although this could lead to longer concurrent and remark (pause) collection times.</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-style: italic; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></span></div><span style="text-align: justify;"><u><span style="font-family: Verdana, serif;">AggressiveOpts</span></u></span><br /><div style="text-align: justify;"><span style="font-family: Courier New, Courier, monospace;">AggressiveOpts</span><span style="font-family: Verdana, serif;">&nbsp;<span style="text-align: start;">as the name suggests helps improve performance by switching on and off certain flags but this strategy hasn't change across various builds of Java and one must examine benchmarks of their system before using this flag in production.</span></span></div><div style="text-align: justify;"><span style="text-align: start;"><span style="font-family: Verdana, serif;"><br /></span></span></div><div style="text-align: justify;"><span style="text-align: start;"><u><span style="font-family: Verdana, serif;">Next Steps</span></u></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">Of the number of flags examined the below are more interesting flags to look at:</span></div><pre><span style="font-family: Courier New, Courier, monospace;">-ea <br />-mx4G <br />-XX:+MaxPermSize=300M <br />-XX:+UseConcMarkSweepGC <br />-XX:+CMSClassUnloadingEnabled <br />-XX:SurvivorRatio=4 <br />-XX:+DisableExplicitGC</span></pre><pre><span style="font-family: Verdana, serif;"><span style="white-space: normal;">Again examine the GC logs to see if any of the above should be used or not, if used, what values are appropriate to set. Quite often the JVM does get it right, right out of the box, hence getting it wrong can be detrimental to your application performance. Its easy to mess up then to get it right, when you have so many flags with dependent and&nbsp;</span><span style="white-space: normal;">overlapping</span><span style="white-space: normal;">&nbsp;</span><span style="white-space: normal;">functionalities.</span></span></pre><pre><span style="font-family: Verdana, serif;"><span style="white-space: normal;"><br /></span></span></pre><pre><span style="font-family: Verdana, serif;"><span style="white-space: normal;"><br /></span></span></pre><pre><span style="white-space: normal;"><span style="font-family: Verdana, serif;"><br /></span></span></pre><pre><span style="white-space: normal;"><span style="font-family: Verdana, serif;"><b><br /></b></span></span></pre><pre><span style="white-space: normal;"><span style="font-family: Verdana, serif;"><b>Conclusion: &nbsp;</b>Refer to benchmarks and GC logs for making decisions on enabling and disabling of flags and the values to set when enabled. Lots of flags, easy to get them wrong, only use them if they are absolutely needed, remember the Hotspot JVM has built in machinery to adapt (adaptive policy), consult an expert if you still want to.</span></span></pre><pre><span style="white-space: normal;"><span style="font-family: Verdana, serif;"><br /></span></span></pre><pre><span style="white-space: normal;"><span style="font-family: Verdana, serif;"><br /></span></span></pre><pre><span style="white-space: normal;"><span style="font-family: Verdana, serif;"><br /></span></span></pre><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-style: italic; text-align: justify;"><span style="font-family: Verdana, serif;">--- The author has done justice by giving us a gist of what the large number of JVM flags and recommend reading the article to learn about specifics of certain flags.. ---</span></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-style: italic; text-align: justify;"><span style="font-family: Verdana, serif;"><br /></span></span></div></div><div style="margin: 0px;"><div style="text-align: justify;"><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">As it is not practical to review all such videos and articles, a number of them have been provided in the links below for further study. In many cases I have paraphrased or directly quoted what the authors have to say to preserve the message and meaning they wished to convey.&nbsp;</span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><i>A few other authors have written articles related to these subjects, for the <a href="http://www.javaadvent.com/" target="_blank">Java Advent Calendar</a>, see below,</i></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><i><a href="http://www.javaadvent.com/2013/12/performance-tuning-measure-dont-guess.html" target="_blank"><span style="font-family: Verdana, serif;">Performance tuning - measure don't guess</span></a></i></div><i><span style="font-family: Verdana, serif;"><a href="http://www.javaadvent.com/2013/12/using-intel-performance-counters-to.html" target="_blank">Using Intel Performance Counters To Tune Garbage Collection</a></span></i><br /><a href="http://www.javaadvent.com/2013/12/how-not-to-measure-latency.html" target="_blank"><i><span style="font-family: Verdana, sans-serif;">How NOT to measure latency</span></i></a></div><div style="-webkit-text-stroke-width: 0px; color: black; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: justify; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;"><br /></span></div><div style="-webkit-text-stroke-width: 0px; color: black; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;"><span style="font-family: Verdana, serif;">Feel free to post your comments below or tweet at&nbsp;<a href="http://twitter.com/theNeomatrix369" target="_blank">@theNeomatrix369</a>!</span></div></div></div></div></div><h2><div style="font-size: medium; font-weight: normal; text-align: justify;"><div><div style="text-align: start;"></div></div></div><ul style="font-size: medium; font-weight: normal;"></ul></h2><h2><strong><span style="font-family: Verdana, serif;">Useful resources</span></strong></h2><div><h2><div style="text-align: justify;"><div style="text-align: start;"><ul><li style="font-size: medium; font-weight: normal;"><i><span style="font-family: Verdana, serif;">Are your GC logs speaking to you, the G1GC edition by Kirk Pepperdine -&nbsp;<a href="http://www.parleys.com/play/51643b58e4b09b60aec89cf4/chapter0/about" target="_blank">Slides</a>&nbsp;-&nbsp;<a href="http://parleys.com/play/517f2503e4b0c6dcd95464ad/chapter0/about" target="_blank">Video</a></span></i></li><li style="font-size: medium; font-weight: normal;"><span style="font-family: Verdana, serif;"><i><a href="http://skillsmatter.com/podcast/home/performance-special-interest-group" target="_blank">Performance Special Interest Group discussion</a>&nbsp;- moderated by Richard Warburton</i><i>&nbsp;(video)</i></span></li><li style="font-size: medium; font-weight: normal;"><span style="font-family: Verdana, serif;"><i><a href="http://parleys.com/play/517fb1c9e4b0c2a859eb9ecb/chapter0/about" target="_blank">Caching in: understand, measure and use your CPU Cache more effectively"</a>&nbsp;by @RichardWarburto -</i><i>&nbsp;(video &amp; slides)</i></span></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://lwn.net/Articles/552095/" target="_blank">Article on Atomic I/O operations (Linux)</a>&nbsp;by Jonathan Corbet</span></em></li><li style="font-size: medium; font-weight: normal;"><i><span style="font-family: Verdana, serif;"><a href="http://www.azulsystems.com/resources/presentations" target="_blank">Articles and Presentations about Azul Zing, Low Latency GC &amp; OpenJDK</a>&nbsp;by Gil Tene (videos &amp; slides)</span></i></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://www.infoq.com/presentations/Lock-Free-Algorithms" target="_blank">Lock-Free Algorithms For Ultimate Performance</a>&nbsp;by Martin Thompson</span></em></li><li style="font-size: medium; font-weight: normal;"><em><a href="https://plus.google.com/communities/107178245817384004088" target="_blank"><span style="font-family: Verdana, serif;">Performance Java User's Group - "For expert Java developers who want to push their systems to the next level"</span></a></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://www.infoq.com/articles/Java-Thread-Pool-Performance-Tuning" target="_blank">Tuning the Size of your thread pool</a>&nbsp;by Kirk Pepperdine</span></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://www.infoq.com/presentations/latency-pitfalls" target="_blank">How NOT to measure Latency</a>&nbsp;by Gil Tene</span></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://www.infoq.com/presentations/Java-GC-Azul-C4" target="_blank">Understanding Java Garbage Collection and What You Can Do about It</a>&nbsp;by Gil Tene</span></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://vanillajava.blogspot.co.uk/search/label/Performance" target="_blank">Vanilla #Java Understanding how Core Java really works can help you write simpler, faster applications</a>&nbsp;by Peter Lawrey</span></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://www.youtube.com/watch?v=Yg6_ulhwLw0" target="_blank">Profiling Java In Production</a>&nbsp;- by Kaushik Srenevasan</span></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://blog.ragozin.info/2013/11/hotspot-jvm-garbage-collection-options.html" target="_blank">HotSpot JVM garbage collection options cheat sheet (v3)</a>&nbsp;by Alexey Ragozin</span></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://static.googleusercontent.com/external_content/untrusted_dlcp/research.google.com/en/us/pubs/archive/40696.pdf" target="_blank">Optimizing Google’s Warehouse Scale Computers: The NUMA Experience</a>&nbsp;-&nbsp; authors from Univ. of Cal (SD) &amp; Google!</span></em></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="https://docs.google.com/viewer?a=v&amp;pid=forums&amp;srcid=MDUxODU4OTA1NTU1MzUxODE5MDQBMTA5MDUzNTI5Mzg2ODk0MjY5NjUBYWM5cnR1MEY4Z1FKATQBAXYy" target="_blank">MegaPipe: A New Programming Interface for Scalable Network I/O</a>&nbsp;by several authors!</span></em></li><li style="font-size: medium; font-weight: normal;"><span style="font-family: Verdana, serif;"><em><a href="http://www.akkadia.org/drepper/cpumemory.pdf" target="_blank">What Every Programmer Should Know About Memory</a>&nbsp;by Ulrich Drepper</em>&nbsp;</span></li><li style="font-size: medium; font-weight: normal;"><em><span style="font-family: Verdana, serif;"><a href="http://www.rdrop.com/users/paulmck/scalability/paper/whymb.2009.04.05a.pdf" target="_blank">Memory Barriers: a Hardware View for Software Hackers</a>&nbsp;- Paul E. McKenney (Linux Technology Center - IBM Beaverton)</span></em></li></ul></div></div><ul style="font-size: medium; font-weight: normal;"></ul><div style="font-size: medium; font-weight: normal;"></div></h2></div><em><span style="font-family: Verdana, serif;">This post is part of the&nbsp;<a href="http://javaadvent.com/">Java Advent Calendar</a>&nbsp;and is licensed under the&nbsp;<a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons 3.0 Attribution</a>&nbsp;license. If you like it, please spread the word by sharing, tweeting, FB, G+ and so on!</span></em>