---
id: 12
title: Doing microservices with micro-infra-spring
date: 2014-12-21T08:57:00+00:00
author: Marcin Grzejszczak
layout: post
permalink: /2014/12/doing-microservices-with-micro-infra-spring.html
blogger_blog:
  - www.javaadvent.com
blogger_author:
  - Marcin Grzejszczak
blogger_permalink:
  - /2014/12/doing-microservices-with-micro-infra.html
blogger_internal:
  - /feeds/2481158163384033132/posts/default/2874044077101876703
categories:
  - 4financeit
  - groovy
  - Java Advent
  - java advent 2014
  - microservices
  - Spring
  - spring boot
---
We've been working at <a href="http://www.4financeit.com/">4financeit</a> for last couple of months on some open source solutions for microservices. I will be publishing some articles related to microservices and our tools and this is the first of (hopefully) many that I will write in the upcoming weeks (months?) on <a href="http://toomuchcoding.blogspot.com/">Too much coding blog.</a><br /><br />This article will be an introduction to the <a href="https://github.com/4finance/micro-infra-spring">micro-infra-spring</a> library showing how you can quickly set up a microservice using our tools.<br /><br /><br /><a name='more'></a><h3>Introduction&nbsp;</h3>Before you start it is crucial to remember that it's not enough to just use our tools to have a microservice. You can check out my slides about microservices and issues that we have dealt with while adopting them at <a href="http://www.4financeit.com/">4financeit</a>.<br /><br /><iframe allowfullscreen="" frameborder="0" height="355" marginheight="0" marginwidth="0" scrolling="no" src="//www.slideshare.net/slideshow/embed_code/42615260" style="border-width: 1px; border: 1px solid #CCC; margin-bottom: 5px; max-width: 100%;" width="425"> </iframe> <br /><div style="margin-bottom: 5px;"><strong> <a href="https://www.slideshare.net/MarcinGrzejszczak/4finance-microservices-122014-at-lodz-jug" target="_blank" title="4financeit microservices 12.2014 at Lodz JUG">4financeit microservices 12.2014 at Lodz JUG</a> </strong> from <strong><a href="https://www.slideshare.net/MarcinGrzejszczak" target="_blank">Marcin Grzejszczak</a></strong> <br /><br />Here you can find my video where I talk about microservice at 4finance (it's from 19.09.2014 so it's pretty outdated)<br /><br /><iframe allowfullscreen="" frameborder="0" height="315" src="//www.youtube.com/embed/f_fGwa2-rMk" width="560"></iframe> <br />Also it's worth checking out the articles of <a href="http://martinfowler.com/articles/microservices.html">Martin Fowler about microservices</a>, <a href="http://highscalability.com/blog/2014/4/8/microservices-not-a-free-lunch.html">Todd Hoff's - Microservices not a free lunch!</a>&nbsp;or&nbsp;<a href="http://www.infoq.com/news/2014/05/microservices">The Strengths and Weaknesses of Microservices by Abel Avram's</a>.<br /><h3>Is monolith bad?</h3>No it isn't! The most important thing to remember when starting with microservices is that it will complicate your life in terms of operations, metrics, deployment and testing. Of course it does bring plenty of benefits but if you are unsure of what to pick - monolith or microservices then my advice to use is to go the monolith way.<br /><br />All the benefits of microservices like code autonomy, doing one thing well, getting ridd of pacakge dependencies can be also achieved in the monolithic code thus try to write your applications with such approaches and your life will get simpler for sure. How to achieve that? That's complicated but here are a couple of hints that I can give you:<br /><ul><li>try to do DDD. No, you don't have DDD when your entities have methods. Try to use concepts of <a href="http://martinfowler.com/bliki/DDD_Aggregate.html">aggregate roots</a></li><li>try not to make dependencies on packages from different roots. If you have two different bounded context like <b>com.blogspot.toomuchcoding.client</b> and <b>com.blogspot.toomuchcoding.loan</b> - go via tight cohesion and low coupling - emit events, call REST endpoint, send JMS messages or talk via strictly defined API. Do not reuse internals of those packages - take a look at the next point that deals with encapsulation</li><li>take your highscool notes and read about encapsulation again. Most of us make the mistake of thinking that if we make a field private and add an accessor to it then we have encapsulation. That's not true! I really like the example of <a href="http://art-of-software.blogspot.com/2008/12/flaczki-kod-obiektowy-zawsze-smaczny-i.html">Slawek Sobotka (article in polish)</a>&nbsp;who shows an example of common approach to encapsulation:<br /><br /><b>human.getStomach().getBowls().getContent().add(new Sausage())</b><br /><br />instead of<br /><br /><b>human.eat(new Sausauge())</b></li><li>add to your IDE class generation template that you want your new classes to be package scoped by default - what should be publicly available are interfaces and really limited number of classes</li><li>start doing what's crucial in terms of tracking microservice requests and measuring business and technical data in your own application! Gather metrics, set up correlation ids for your messages, add service discovery if you have multiple monoliths.</li></ul><h3>I'm a hipster - I want microservices!</h3><div>Let's assume that you know what you are doing, you evaluated all pros and cons and you want to go down the microservice way. You have a devops culture there in your company and people are eager to start working on multiple codebases. How to start? Pick our tools and you won't regret it ;)</div><h3>Clone a repo and get to work</h3><div>We have set up a working template on Github with UI - <a href="https://github.com/4finance/boot-microservice-gui">boot-microservice-gui</a> and without it - <a href="https://github.com/4finance/boot-microservice">boot-microservice</a>. If you clone our repo and start working with it you get a service that:</div><div><ul><li>uses micro-infra-spring library</li><li>is written in Groovy</li><li>uses Spring Boot</li><li>is built with Gradle (set up for 4finance - but that's really easy to change)</li><li>is JDK8 compliant</li><li>contains an example of a business scenario</li></ul></div><div>what you just have to do is:</div><div><ul><li>check out the slides above to see our approach to microservices</li><li>remove the packages&nbsp;com/ofg/twitter from src/main and src/test</li><li>alter microservice.json to support your requirements</li><li>write your code!</li></ul></div><div>Why should you use our repo?</div><div><ul><li>you don't have to set up anything - we've already done it for you</li><li>the time required to start developing a feature is close to zero</li></ul></div><h3>Aren't we duplicating Spring Cloud?</h3><div>In fact we're not. We're using it in our libraries ourselves (right now for property storage in Git repository). We have some different approaches to service discovery for instance but in general we are extending Spring Cloud's features by:</div><div><ul><li><a href="https://github.com/4finance/micro-infra-spring/wiki/CorrelationId-setting">correlation id setting</a> (we support different libraries) which is crucial for log aggregation approaches</li><li><a href="https://github.com/4finance/micro-infra-spring/wiki/Metrics-publishing">metrics path prepending</a> (accoriding to a defnied pattern)</li><li>giving you <a href="https://github.com/4finance/micro-infra-spring/wiki/Swagger-API-documentation">Swagger API</a>&nbsp;and <a href="https://github.com/4finance/micro-infra-spring/wiki/Swagger-UI">Swagger UI</a></li><li>allowing you to <a href="https://github.com/4finance/micro-infra-spring/wiki/Centralized-configuration-management">pick properties from a repository on your drive</a></li><li>soon we will be able to sketch graphs of dependencies between services</li><li>we give you <a href="https://github.com/4finance/micro-infra-spring/wiki/How-to-test-it#how-to-test-it">Consumer Driven Contract</a> approach&nbsp;</li><li>testing our solutions on production - as a company we're giving short term loans so this in our system where we test our open source ideas</li></ul></div><h3>Conclusions</h3><div>If you want to go down the microservice way you have to be well aware of the issues related to that approach. If you know what you're doing you can use our libraries and our microservice templates to have a fast start into feature development.&nbsp;</div><h3>What's next</h3><div>On my blog at <a href="http://toomuchcoding.blogspot.com/">toomuchcoding.blogspot.com</a> I'll write about different features of the micro-infra-spring library with more emphasis on configuration on specific features that are not that well known but equally cool as the rest ;) Also I'll write some articles on how we approached splitting the monolith but you'll have to wait for that some time ;)</div><div><br /></div></div><em>This post is part of the&nbsp;<a href="http://javaadvent.com/">Java Advent Calendar</a>&nbsp;and is licensed under the&nbsp;<a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons 3.0 Attribution</a>&nbsp;license. If you like it, please spread the word by sharing, tweeting, FB, G+ and so on!</em>