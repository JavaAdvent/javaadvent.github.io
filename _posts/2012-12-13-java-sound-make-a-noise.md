---
id: 76
title: 'Java Sound &#8211; Make A Noise'
date: 2012-12-13T09:00:00+00:00
author: Alexander Turner
layout: post
guid: http://www.javaadvent.com/2012/12/java-sound-make-a-noise/
permalink: /2012/12/java-sound-make-a-noise.html
blogger_blog:
  - www.javaadvent.com
blogger_author:
  - Alexander Turner
blogger_permalink:
  - /2012/12/java-sound-make-noise.html
blogger_internal:
  - /feeds/2481158163384033132/posts/default/6946948222211829289
categories:
  - 2012
  - audio
  - java
---
<h2>The JDK has a audio integration as standard - but for some reason it is ill used and poorly documented.</h2>When I started coding <a href="http://www.sonicfield.co.uk/">Sonic Field</a> it was silent. Yes, it could synthesis audio signals and processes recordings; however, playing an arbitrary piece of audio with javax.sound was beyond me and even Google did not seem able to help. Well, I did eventually figure it out and so I hope this post can help others avoid my pain to come to bring Java to audio and the other way around.<br />The first step is to get the javax.sound api imported. For the example here, the imports are: <br /><pre><code><br />import javax.sound.sampled.AudioFormat;<br />import javax.sound.sampled.AudioSystem;<br />import javax.sound.sampled.DataLine;<br />import javax.sound.sampled.SourceDataLine;<br /></code></pre><br />That was the easy bit. The hard bit is figuring out what to do with it. The api was designed around using pre-cooked audio sources and performing effects and mixes on them. What is really hard to figure out is how to play audio you have made programmatically. However, it is possible using the AudioFormat class. This is able to understand some simple formats and make audio sources from byte arrays holding them. For audio output 16 bit signed linear encoding is really simple and good enough for listening to. So, in the example below I show how to code up 16 bit signal and play it on the default output device. <br /><br /><pre><code><br />// Please note that this code is under AGPL 3.0 <br />// within Sonic Field.<br /><br />// I have relaxed this snippet and this snippet only<br />// to the CC license for the Java Advent Calendar project.<br /><br />// The key thing to understand is the AudioFormat. <br />// This is actually the <br />// class which understands the binary format of <br />// audio which the computer cna<br />// use to make sound. Here we are specifying <br />// sixteen bit signed audio<br />AudioFormat af = new AudioFormat((float) SFConstants.SAMPLE_RATE, 16, 1, true, true);<br />// SFConstants,SAMPLE_RATE is in <br />// samples per second - it is part of Sonic Field<br />// here it is 96000, which is a good choice. <br />// 44100 is CD rate as an alternative.<br /><br />// These two lines link the AudioFormat class <br />// to the default output device for <br />// the computer. It is possible choose between <br />// different audio output devices<br />// but that is for another post.<br />DataLine.Info info = new DataLine.Info(SourceDataLine.class, af);<br />SourceDataLine source = (SourceDataLine) AudioSystem.getLine(info);<br />source.open(af);<br />source.start();<br />// OK dataIn is a Sonic Field type. <br />// However, it is just a wrapped float array.<br />// what we need to do is convert a series of <br />// floats into the 16 bit signed format<br />// we specified. javax.sound does not really <br />// help us much here. We have to<br />// do the conversion out selved. Fortunately, it is easy.<br />byte[] buf = new byte[dataIn.getLength() * 2];<br />for (int i = 0; i &lt; buf.length; ++i)<br />{<br />    short sample = (short) (dataIn.getSample(i / 2) * 32767.0);<br />    buf[i] = (byte) (sample &gt;&gt; 8);<br />    buf[++i] = (byte) (sample &amp; 0xFF);<br />}<br />// Now we have a byte array with <br />// 16 bit signed audio, we can just play it.<br />// This is done via the 'write' method on our SourceDataLine<br />source.write(buf, 0, buf.length);<br />// The source plays asynchronously using buffering. <br />// If we want to know when it<br />// has finished we need to call the drain method <br />// which only returns when all current audio as played <br />source.drain();<br />// Finally we can shut everything down<br />source.stop();<br />source.close();<br /></code></pre><br />I hope that the comments above help explain what is happening. I noticed that  they do make reading the code a little tricky, so here is the code without the comments. <br /><br /><pre><code>AudioFormat af = new AudioFormat((float) SFConstants.SAMPLE_RATE, 16, 1, true, true);<br />DataLine.Info info = new DataLine.Info(SourceDataLine.class, af);<br />SourceDataLine source = (SourceDataLine) AudioSystem.getLine(info);<br />source.open(af);<br />source.start();<br />byte[] buf = new byte[dataIn.getLength() * 2];<br />for (int i = 0; i &lt; buf.length; ++i)<br />{<br />    short sample = (short) (dataIn.getSample(i / 2) * 32767.0);<br />    buf[i] = (byte) (sample &gt;&gt; 8);<br />    buf[++i] = (byte) (sample &amp; 0xFF);<br />}<br />source.write(buf, 0, buf.length);<br />source.drain();<br />source.stop();<br />source.close();<br /></code></pre><br /><strong>Sonic Field</strong> is an open source (AGPL) audio processing and synthesis system written in pure Java (no JNI, only standard Java). For more information on the project please feel free to check out the links below. The source code and associated sites will provide a large amount of useful information on audio and Java. <br /><ul><li><a href="http://www.sonicfield.co.uk/">Sonic Field's webside</a></li><li><a href="http://sonic-field.blogspot.co.uk/">Sonic Field's blog</a></li></ul><br /><strong>By:</strong> Dr Alexander J Turner: I would like to thank Attila for contacting me and organising this interesting project. Feel free to pop over to my blog at <a href="http://nerds-central.blogspot.com/" target="_blank">Nerds-Central</a> at any time :)<br /> <p><em>Meta: this post is part of the <a href="http://javaadvent.com/">Java Advent Calendar</a> and is licensed under the <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons 3.0 Attribution</a> license. If you like it, please spread the word by sharing, tweeting, FB, G+ and so on! Want to write for the blog? We are looking for contributors to fill all 24 slot and would love to have your contribution! <a href="mailto:dify.ltd@gmail.com">Contact Attila Balazs</a> to contribute!</em></p>