---
id: 27
title: Mutation testing in Java with PIT and Gradle
date: 2014-12-07T08:01:00+00:00
author: gpanther
layout: post
guid: http://www.javaadvent.com/2014/12/mutation-testing-in-java-with-pit-and-gradle/
permalink: /2014/12/mutation-testing-in-java-with-pit-and-gradle.html
blogger_blog:
  - www.javaadvent.com
blogger_author:
  - Florin Bunau
blogger_permalink:
  - /2014/12/mutation-testing-in-java-with-pit-and.html
blogger_internal:
  - /feeds/2481158163384033132/posts/default/8298435877351167074
dsq_thread_id:
  - 4962579262
categories:
  - 2014
  - gradle
  - java
  - mutation
  - mutation testing
  - PIT
  - unit testing
---
<div>A project might find itself in different stages of unit test line and branch coverage.</div><div><br /></div><div>But what does that really say about a project? If it's 100% covered, is it really tested?<o:p></o:p></div><div><br /></div><div>Or as wikipedia puts it :<br /><blockquote><i>Tests can be created to verify the correctness of the implementation of a given software system, but the creation of tests still poses the question whether the tests are correct and sufficiently cover the requirements that have originated the implementation.&nbsp;</i></blockquote></div><div>Whether intentionally doing a poor job, or just being sloppy, coverage percentages just serve as a nice tool to <strike>lie</strike> bring reassurances to oneself or to the management about quality.</div><div><br /></div><div>The real measure of quality are the tests quality AND the amount covered.<o:p></o:p></div><div><br /></div><div>So this begs the question, besides reviewing the tests alongside the code and giving it some subjective grade, is there such a tool that can speak volumes about the quality of tests ?</div><div><o:p></o:p></div><div><br /></div><div>The answer is Yes: <b><a href="http://en.wikipedia.org/wiki/Mutation_testing">Mutation testing</a></b><o:p></o:p></div><div><br /></div><div>I won't bore you with the details you can find out more on the provided links, but the basic idea is :<o:p></o:p></div><div>If you modify the code in some non-equivalent way and the test still pass, you have bad tests, and some programming error down the line won't be caught by the tests.</div><div><br /></div><div>Fortunately some nice folks are working on a really cool project called <a href="http://pitest.org/">PIT</a>&nbsp;(<a href="https://github.com/hcoles/pitest">github</a>),&nbsp;which is a mutation tester for Java.</div><div><br /></div><div>I encourage you to read everything on the site including the <a href="http://pitest.org/links/">media links</a>&nbsp;and try it out.</div><div><o:p></o:p></div><div><br /></div><div>For the purpose of this article I will provide an example project for showcasing mutation testing with PIT, including a gradle build script. This is made possible by the <a href="http://gradle-pitest-plugin.solidsoft.info/">PIT gradle plugin</a>&nbsp;</div><div><o:p></o:p></div><div><br />Github for this post here : <a href="https://github.com/fbunau/game-of-life-mutation-test">game-of-life-mutation-test</a><br /><br /></div><div>I choose to implement <a href="http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway's Game of Life</a>, inspired by the <a href="http://globalday.coderetreat.org/">Global Day of Code Retreat</a>. One of the tests is commented. Let's assume in a real world scenario we would have written all the tests there, without that one.</div><div><o:p></o:p></div><div><br /></div><div></div><div>Coverage tools report 100% line coverage and branch coverage ( ignoring the equals method )<o:p></o:p></div><div><br /></div><div>Eclipse with EclEmma and Intellij Coverage report :&nbsp;</div><div><br /></div><div style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-t08ldlBHpbc/VIN-Hv_PVxI/AAAAAAAADig/zXnYWj8NnI8/s1600/line_coverage.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-t08ldlBHpbc/VIN-Hv_PVxI/AAAAAAAADig/zXnYWj8NnI8/s1600/line_coverage.png" height="313" width="640" /></a></div><div style="clear: both; text-align: center;"><br /></div><div style="clear: both; text-align: center;"></div><div style="text-align: left;"><br /></div><div style="text-align: left;">At this point you might call it a day and a job well done. Test look preety thorough, and there are a lot of them, the code is tested, but are the tests solid?</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Turns out they are not. If we run the PIT tester</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><code>gradle pitest</code><br /><code><br /></code></div>reports will be generated on the path <br /><code> game-of-life-mutation-testbuildreportspitest&lt;timestamp&gt;index.html </code> <br /><code><br /></code><br /><div style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-2b9xInvfHoc/VIOBYR1zciI/AAAAAAAADis/VBDnaJw5v4I/s1600/mutation_coverage1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-2b9xInvfHoc/VIOBYR1zciI/AAAAAAAADis/VBDnaJw5v4I/s1600/mutation_coverage1.png" height="304" width="400" /></a></div><div style="clear: both; text-align: center;"><br /></div><div style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-6cPSHeXv6bo/VIOBfNzFAwI/AAAAAAAADi0/COB91viKFyI/s1600/mutation_coverage2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-6cPSHeXv6bo/VIOBfNzFAwI/AAAAAAAADi0/COB91viKFyI/s1600/mutation_coverage2.png" height="500" width="640" /></a></div><div style="clear: both; text-align: center;"><br /></div><code><br /></code><br /><div style="clear: both; text-align: left;">PIT has detected that if we negate the condition test pass all the same.</div><div style="clear: both; text-align: left;"><br /></div><div style="clear: both; text-align: left;">It would be easy to make this mistake, or some other developer to alter the code in such a subtle way and no one to notice until one day when the code will not work as expected in a production environment.</div><div style="clear: both; text-align: left;"><br /></div><div style="clear: both; text-align: left;">To solve this uncomment the glider test ( a more complex test for GoL ).</div><div style="clear: both; text-align: left;"><br /></div><div style="clear: both; text-align: left;">If you trully believe you have quality tests, consider running mutation testing for an extra verification.</div><div><o:p></o:p> <em>This post is part of the&nbsp;<a href="http://javaadvent.com/">Java Advent Calendar</a>&nbsp;and is licensed under the&nbsp;<a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons 3.0 Attribution</a>&nbsp;license. If you like it, please spread the word by sharing, tweeting, FB, G+ and so on!</em> </div>