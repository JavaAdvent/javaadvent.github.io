---
id: 48
title: 'Project Avatar &#8211; The next Java EE Feature?'
date: 2013-12-12T08:01:00+00:00
author: Markus Eisele
layout: post
guid: http://www.javaadvent.com/2013/12/project-avatar-the-next-java-ee-feature/
permalink: /2013/12/project-avatar-the-next-java-ee-feature.html
blogger_blog:
  - www.javaadvent.com
blogger_author:
  - Markus Eisele
blogger_permalink:
  - /2013/12/project-avatar-next-java-ee-feature.html
blogger_internal:
  - /feeds/2481158163384033132/posts/default/5892748771248389952
dsq_thread_id:
  - 4962579233
categories:
  - 2013
  - Avatar
  - JavaEE
  - JavaScript
---
<div dir="ltr" style="text-align: left;">It is this time of the year again. Christmas holidays are approaching fast and the Java Advent Calender is filling up constantly. Today it's on me to write my surprise post. I'm <a href="http://blog.eisele.net/" target="_blank">Markus</a>, also known as <a href="https://draft.blogger.com/twitter.com/myfear" target="_blank">@myfear</a> and I've been working with and around <a href="https://draft.blogger.com/www.oracle.com/technetwork/java/javaee/%E2%80%8E" target="_blank">Java EE</a> and a bunch of related servers since many years. Beside the daily work I started more actively contributing to the Java EE Expert Group with the <a href="https://github.com/javaee-samples/javaee7-samples" target="_blank">Java EE 7</a> release. With EE 7 out the door since a while it is already time to start planning for the next revision of the platform which will most likely be called Java EE 8. Oracle set up a <a href="https://www.surveymonkey.com/s/KGV7RWS" target="_blank">community survey</a> with which they would like to get input from the community on the relative importance of some of the features they intend to add. First of all this should encourage the interested reader to participate and <a href="https://www.surveymonkey.com/s/KGV7RWS" target="_blank">take the survey</a>. One particular point in it is all about support for HTML 5 based, dynamic applications. While WebSocket and JSON Processing already made it into Java EE 7 there is another feature particularly in GlassFish and WebLogic (via <a href="https://jersey.java.net/documentation/latest/sse.html" target="_blank">Jersey</a>) at the moment which has some potential to be standardized. The Server Sent Events (SSE). It already is part of the <a href="http://www.w3schools.com/html/html5_serversentevents.asp" target="_blank">HTML5 spec</a> and would be a very good candidate for standardization. But Oracle is thinking even further and is asking if there would be enough support and interest to actually standardize the use of JavaScript on &nbsp;Java EE servers. When this kind of question started to appear at JavaOne 2012 it was basically referred to as <a href="https://groups.google.com/forum/#!topic/nodejs/750fF6ruAdY" target="_blank">Node.jar</a>&nbsp;on <a href="http://openjdk.java.net/projects/nashorn/" target="_blank">Nashorn</a>. Since this September we know the real name: <a href="https://avatar.java.net/" target="_blank">Project Avatar</a>.<br /><br /><b>Avatar At A Glance</b><br />Project Avatar provides a JavaScript services layer zeroed in on supporting REST, WebSockets and Server-Sent Events, and a rich client side framework that assumes very minor JavaScript knowledge. The services side is focused on building data services using JavaScript, while the optional client side is entirely focused on supporting HTML5 and TSA (Thin Server Architecture).<br /><br /><br /><table align="center" cellpadding="0" cellspacing="0" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-C-eMD_iWmck/UqbaCQKE8fI/AAAAAAAAfOw/bJ9J367q47I/s1600/avatar-arch.png" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-C-eMD_iWmck/UqbaCQKE8fI/AAAAAAAAfOw/bJ9J367q47I/s1600/avatar-arch.png" height="148" width="320" /></a></td></tr><tr><td style="text-align: center;">Project Avatar (Source: <a href="https://avatar.java.net/essentials.html" target="_blank">avatar.java.net</a>)</td></tr></tbody></table><br /><b>Thin Server Architecture</b><br />With the introduction of HTML5, CSS3 and fast JavaScript engines, modern browsers have become a powerful platform. In the advent of the so called single-page application (SPA), also known as single-page interface (SPI) the design of modern user interfaces shifted away from server side generation to web applications or web sites that fits on a single web page with the goal of providing a more fluid user experience akin to a desktop application. An SPA moves logic from the server to the client. This results in the role of the web server evolving into a pure data API or web service.&nbsp;This architectural approach has been coined "Thin Server Architecture" to indicate that complexity moved from the server to the client while reducing overall system complexity.<br /><br /><b>What is really in Avatar?</b><br />But Avatar is far more than just a TSA approach. It basically consists of three parts. The foundation is build by the upcoming Java 8 and it's included JavaScript implementation called Nashorn. On top of it is the Avatar Runtime including an additional compiler layer and a Servlet API based server. Those abstractions &nbsp;enable it to be hosted on various runtimes.&nbsp;Avatar applications are comprised of either client side ‘views’, server side ‘services’ or both. Importantly, there is no inherent coupling between them which enables views to communicate with existing services and for services to be consumed by any type of client. An application ‘archive’ is deployed on the server and is compiled to generate JavaScript tailored to the application. Generated JavaScript for views handles data-binding with the DOM/UI as well as data-management to remote services and local storage. The Avatar archives are somewhat similar to Java EE web-archives. They consist of a WEB-INF folder, an&nbsp;avatar.properties file in the root and either a views directory and/or a service directory. Both file-system directories or .zip (.war) files are supported by Avatar.<br /><br /><b>All that is left on the Server - Services</b><br />An service extends either a REST, WebSocket or Push (SSE) abstraction and it's life-cycle is completely handled by the framework. Service implementations can leverage built-in Node modules as well as most third-party modules. Thanks to Nashorn's support for direct invocation of Java code you can also use most Java libraries directly.<br /><br /><b>The Client Side - Views</b><br />A view is the HTML required by the browser. It also contains custom 'data-' HTML extensions and simple JavaScript models. Those views get translated by a (server-side) compiler before sending the complete SPA HTML file including the custom generated JavaScript to the browser.<br /><br /><b>Putting it all together. A Simple Example.</b><br />Oracle provides a decent set of examples and documentation for Avatar which basically is enough to get you started. First thing to try it out yourself is a <a href="https://jdk8.java.net/download.html" target="_blank">JDK 8 Early Access Build</a> for your OS. At the time of writing I tried it with the latest Developer Preview b118. After installing you need to get the latest <a href="https://glassfish.java.net/download.html" target="_blank">GlassFish Open Source Edition 4.0</a> server and unzip it into a suitable location. Make sure it runs with the installed JDK 8 by either putting &lt;jdk8&gt;/bin to your PATH environment variable or adding the following entry to the &lt;gf4&gt;/glassfish/config asenv.bat/conf<br /><br /><pre style="background-color: white; border: 1px solid rgb(136, 136, 136); color: #222222; font-size: 13px; max-height: 700px; overflow: auto; padding: 10px; width: auto; word-wrap: normal;"><span style="color: black; font-family: 'Times New Roman'; font-size: small; white-space: normal;">set AS_JAVA=&lt;jdk8&gt;</span></pre><br />No go ahead to download latest <a href="https://avatar.java.net/download.html" target="_blank">avatar-1.0-ea.zip</a> and expand it to the &lt;gf4&gt;/glassfish/ directory. After that you need to&nbsp;set a AVATAR_HOME environment variable and point it to the &lt;gf4&gt; install directory. And make sure to add %AVATAR_HOME%glassfishbin to your PATH environment variable.<br />If all of that is done you can switch to your workspace folder and issue the following command to have Avatar creating a simple example app for you:<br /><br /><pre style="background-color: white; border: 1px solid rgb(136, 136, 136); color: #222222; font-size: 13px; max-height: 700px; overflow: auto; padding: 10px; width: auto; word-wrap: normal;"><span style="color: black; font-family: 'Times New Roman'; font-size: small; white-space: normal;">avatar new --example=hello</span></pre><div><span style="color: black; font-family: 'Times New Roman'; font-size: small; white-space: normal;"><br /></span></div>It creates a basic "hello" application which only consists of a view. It is a good place to start exploring and you can directly start your Glassfish instance afterwards and deploy the application as you would with every typical Java EE application:<br /><br /><pre style="background-color: white; border: 1px solid rgb(136, 136, 136); color: #222222; font-size: 13px; max-height: 700px; overflow: auto; padding: 10px; width: auto; word-wrap: normal;"><div style="color: black; font-family: 'Times New Roman'; font-size: medium; white-space: normal;"><br />asadmin start-domain</div><br /><div style="color: black; font-family: 'Times New Roman'; font-size: medium; white-space: normal;"><br />asadmin deploy hello</div><br /></pre><div><br /><table cellpadding="0" cellspacing="0" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-ArNjsok0faE/UqbnhZsKUKI/AAAAAAAAfPA/Xf4KbAKA7EE/s1600/hello-example.PNG" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-ArNjsok0faE/UqbnhZsKUKI/AAAAAAAAfPA/Xf4KbAKA7EE/s1600/hello-example.PNG" /></a></td></tr><tr><td style="text-align: center;">The "hello-example" app.</td></tr></tbody></table>Pointing your browser to <a href="http://localhost:8080/hello" target="_blank">http://localhost:8080/hello</a> will display the application. You can start editing the view located at &lt;workspace&gt;/hello/view/src/hello.html directly. While the server is running Avatar takes care of re-compiling it directly for the next request. This ensures a rapid development. This behavior is controlled by the "debug=true" property in the&nbsp;avatar.properties file and can be altered for productive systems. Further on, setting it to false causes all .js and .css files to be minimized before delivery.<br />At least if you first download and add the required YUI Compressor (<a href="https://github.com/yui/yuicompressor/releases/download/v2.4.8/yuicompressor-2.4.8.jar" target="_blank">jar download</a>) to Avatar first. Due to license restrictions it hasn't been bundled. Simply put it into &lt;gf4&gt;/glassfish/modules/avatar-ext/lib. You might need to create that directory first.<br /><br />Beside this very simple example without any service at all there are more complex ones available with the distribution at %AVATAR_HOME%/Project-Avatar-examples/. For convenience reasons there is a complete examples.ear available which can be directly deployed and tested. To access the samples simply prefix the example name with "demo-". So the "rest" example can be accessed via <a href="http://localhost:8080/demo-rest/" target="_blank">http://localhost:8080/demo-rest/</a>.<br /><table cellpadding="0" cellspacing="0" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-dV0y5-ShJxA/UqbqAcA5dyI/AAAAAAAAfPM/pKCtdqqlEUg/s1600/todoapp.PNG" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-dV0y5-ShJxA/UqbqAcA5dyI/AAAAAAAAfPM/pKCtdqqlEUg/s1600/todoapp.PNG" height="209" width="320" /></a></td></tr><tr><td style="text-align: center;">TodoMVC - Example App with Avatar</td></tr></tbody></table>You have to look out for different features to be showcased in the different examples. If you want to know how Avatar handles persistence you can exactly look into the rest example which uses a FileDataProvider to save the items. Another interesting example is the TodoMVC based app (<a href="http://localhost:8080/demo-todo/" target="_blank">http://localhost:8080/demo-todo/</a>). It showcases a more complex view which also has been styled.<br /><br /><b>What is next?</b><br />As of today nobody knows what is going to happen with Avatar. The community feedback hasn't been tremendously loud or excited in general. I guess the reason for it is that nobody really knows what to do with it. The biggest drawback as of today is, that it only runs with GlassFish which will further limit adoption and community interest. Given the fact, that SSE isn't part of the Java EE specification it might make it even more difficult to port it to other app-server. Even if the license (<a href="https://avatar.java.net/license.html" target="_blank">GPL2 with Classpath Exception</a>) should allow it. Back to the initial survey and the thought about specifying a server side JavaScript integration with Java EE, you know at least have a brief idea about what Oracle is talking if they are talking about Avatar. Go ahead and <a href="https://www.surveymonkey.com/s/KGV7RWS" target="_blank">take that survey</a> and tell them what you are thinking about having that kind of stuff in Java EE.<br /><br /></div>I wish you a happy holiday season and a new year filled with peace and prosperity.<br /><br /><em>Meta: this post is part of the&nbsp;<a href="http://javaadvent.com/">Java Advent Calendar</a>&nbsp;and is licensed under the&nbsp;<a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons 3.0 Attribution</a>&nbsp;license. If you like it, please spread the word by sharing, tweeting, FB, G+ and so on!</em></div>